<div id="page-checkout-container"
     class="mx-auto flex min-h-dvh w-full min-w-[320px] flex-col bg-gray-100 dark:bg-gray-900 dark:text-white">

  <header id="page-header" class="flex-none z-10 bg-white shadow-sm dark:bg-gray-700 w-full">
    <div class="px-4 lg:px-8 xl:px-8">
      <app-navbar></app-navbar>
    </div>
  </header>

  <section class="mx-auto max-w-screen-xl px-4 py-8 2xl:px-0">

    @defer {
      @if (pedido){
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 space-y-6">
          <div class="border border-dashed border-[#103320] dark:border-[#c6b89b] rounded-md p-4 text-center mb-6">
            <h2 class="text-xl font-bold text-[#103320] dark:text-[#c6b89b] uppercase">Gracias. Tu pedido ha sido recibido.</h2>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 text-sm bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md p-6 shadow-sm">
            <div class="space-y-2">
              <div>
                <p class="font-semibold text-gray-700 dark:text-gray-300">Número del pedido</p>
                <p class="text-gray-900 dark:text-white"># {{ pedido.docNum}}</p>
              </div>
              <div>
                <p class="font-semibold text-gray-700 dark:text-gray-300">Fecha</p>
                <p class="text-gray-900 dark:text-white"> {{pedido.creadoEn | date }} </p>
              </div>
            </div>

            <div class="space-y-2">
              <div>
                <p class="font-semibold text-gray-700 dark:text-gray-300">Total</p>
                <p class="text-gray-900 dark:text-white"> {{pedido.total | currency}} </p>
              </div>
              <div>
                <p class="font-semibold text-gray-700 dark:text-gray-300">Método de pago</p>
                <p class="text-gray-900 dark:text-white"> Transferencia </p>
              </div>
            </div>
          </div>


          <!-- Instrucciones para transferencia -->
          <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md p-6 space-y-4 text-sm leading-relaxed">
            <h3 class="text-lg font-bold text-[#103320] dark:text-[#c6b89b]">Pasos a seguir para transferencia bancaria</h3>
            <ol class="list-decimal list-inside space-y-1">
              <li>Realiza el pago en las cuentas correspondientes.</li>
              <li>Haz una captura de pantalla del comprobante y envíala por <strong>WhatsApp</strong> usando el botón de abajo. En el mensaje, incluye el número de pedido.</li>
              <li>Espera a que tu pedido se complete.</li>
            </ol>

            <div class="border-t pt-4">
              <h4 class="font-semibold mb-1">Nuestros detalles bancarios</h4>
              <p><strong>Cuenta: </strong>Cuenta de ahorro transaccional</p>
              <p><strong>Banco: </strong>Banco Pichincha</p>
              <p><strong>Número de cuenta: </strong>2213423084</p>
            </div>

            <!-- Botón de WhatsApp -->
            <div class="pt-4">
              <button
                type="button"
                (click)="enviarComprobantePorWhatsApp(pedido.docNum)"
                class="inline-flex items-center gap-2 px-4 py-2 bg-[#25D366] text-white text-sm font-medium rounded-md hover:bg-[#1ebe5d] transition"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20.52 3.48A11.93 11.93 0 0012 0C5.37 0 0 5.37 0 12c0 2.11.55 4.1 1.6 5.88L0 24l6.3-1.65A11.93 11.93 0 0012 24c6.63 0 12-5.37 12-12 0-3.19-1.24-6.19-3.48-8.52zM12 22c-1.85 0-3.66-.5-5.25-1.45l-.38-.22-3.73.98.99-3.63-.24-.38A9.93 9.93 0 012 12c0-5.52 4.48-10 10-10s10 4.48 10 10-4.48 10-10 10zm5.2-7.8c-.28-.14-1.65-.81-1.9-.9-.26-.1-.45-.14-.64.14-.19.28-.74.9-.9 1.08-.17.19-.34.21-.62.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.4-1.65-1.56-1.93-.17-.28-.02-.43.13-.57.13-.13.28-.34.42-.51.14-.17.19-.28.28-.47.09-.19.05-.36-.02-.5-.07-.14-.64-1.54-.88-2.1-.23-.56-.47-.48-.64-.49h-.55c-.19 0-.5.07-.76.36s-1 1-1 2.43 1.02 2.82 1.16 3.02c.14.19 2.01 3.07 4.88 4.3.68.29 1.2.46 1.61.59.68.22 1.3.19 1.79.12.55-.08 1.65-.67 1.88-1.31.23-.64.23-1.19.16-1.31-.07-.12-.26-.19-.54-.33z"/>
                </svg>
                Enviar comprobante por WhatsApp
              </button>
            </div>
          </div>

          <div class="border-t pt-4">
            <h3 class="text-lg font-semibold mb-2">Detalles del pedido</h3>
            <ul class="space-y-2">
              @for (item of pedido.items; track $index) {
                <li class="flex items-center justify-between gap-4 py-3 border-b border-gray-200">
                  <!-- Imagen del producto -->
                  <img
                    [src]="urlItem(item.productoId)"
                    loading="lazy"
                    alt="{{ item.descripcion }}"
                    class="w-12 h-12 object-cover rounded-md border"
                  />

                  <!-- Detalles del producto -->
                  <div class="flex-1">
                    <p class="text-sm font-medium text-gray-600">{{ item.descripcion }}</p>
                    <p class="text-xs text-gray-500">
                      Cantidad: {{ item.cantidad }} × {{ item.pvp | currency }}
                    </p>
                  </div>

                  <!-- Total del ítem -->
                  <div class="text-sm font-semibold text-gray-600">
                    {{ item.cantidad * item.pvp | currency }}
                  </div>
                </li>
              }
            </ul>
          </div>

          @if (cliente){
          <div class="pt-4">
              <h3 class="text-lg font-semibold mb-2">Informacion del Cliente</h3>
            <p> {{cliente.nombre}} </p>
            <p> {{cliente.apellido}} </p>
            <p> {{pedido.ciudad}} ,  {{pedido.provincia}} </p>
            <p> {{cliente.email}} </p>
          </div>
          }
        </div>
      } @else {
        <section class="pedido-error">
          <h2>Pedido no encontrado</h2>
          <p>Verifica el código o vuelve al inicio.</p>
          <a routerLink="/">Ir al inicio</a>
        </section>
      }
    } @placeholder (minimum 200ms){
      <div class="absolute inset-0  flex items-center justify-center z-10">
        <img
          [src]="'images/loading/loading.gif'"
          alt="Cargando..." class="w-60 h-60 mt-52 rounded-full object-cover object-center"/>
      </div>
    }

  </section>

  <footer class="mt-auto w-full bg-white dark:bg-gray-700">
    <app-footer></app-footer>
  </footer>
</div>
